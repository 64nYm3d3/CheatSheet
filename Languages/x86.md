# This is Advanced Darkness
Here is a secret that hits my greatest fear, the shellcoder cometh.

This is about x86 (mostly in the context of IA32 progcessors). Opcode fall under such a strange category for me, you code in C and then convert it to x86. You use small registers trying to avoid bad chars but it might be easier to just use msfencode, then again with that you're borrowing someone elses code for these environments. Maybe you need the same thing but with less space, lets say you need a reverse shell and know you can run it with less space in the same system than msfencode reverse shell, what do you do?

A modern computer makes no real distinction between instructions and data. If a processor can be fed instructions when it should be seeing data, it will happily go about executing the passed instructions. This characteristic makes system exploitation possible.

## Quickguuide

Stack - grows down LIFO
Heap - grows up FIFO



#### Memory Management

You need to understand memory management in order to understand how memory overflows from portion of memory to another.

When a program is executed, it is laid out and mapped into memory in this order. 

1. First, the operating system creates an address space in which the program will run. This address space includes the actual program instructions as well as any required data.

2. Next, information is loaded from the program’s executable file to the newly created address space. There are three types of segments: .text , .bss , and .data .

    - The .bss and .data segments are reserved for global variables and are **writeable**.
    - The .data segment contains static initialized data, and the .bss segment contains uninitialized data**writeable**. 
    - The final segment, .text , holds the program instructions and **readable**.
    
3. Finally, the stack and the heap are initialized. The stack is a data structure, more specifically a Last In First Out (LIFO) data structure, which means that the most recent data placed, or pushed, onto the stack is the next item to be removed, or popped, from the stack. A LIFO data structure is ideal for storing transitory information, or information that does not need to be stored for a lengthy period of time. The stack stores local variables, information relating to function calls, and other information used to clean up the stack after a function or procedure is called. The heap is another data structure used to hold program information, more specifically, dynamic variables. The heap is (roughly) a First In First Out (FIFO) data structure. Data is placed and removed from the heap as it builds. 

Another thing it's important to know is that- 

The stack grows down the address space: as more data is added to the stack, it is added at increasingly lower address values.

The heap grows up the address space: As data is added to the heap, it is added at an increasingly higher address value.

~~~
↑ Lower addresses (0x08000000)
Shared libraries
.text
.bss
Heap (grows ↓)
Stack (grows ↑)
env pointer
Argc
↓ Higher addresses (0xbfffffff)
~~~
#### Registers

Registers are memory and usually tied to hardware. Registers can be grouped into 4 categories.
 * General Purpose
 * Segment
 * Control
 * Other


---
Refs:
Shellcoders handbook
